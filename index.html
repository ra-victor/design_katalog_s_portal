<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beställningsformulär - Nordic Business Solutions AB</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2d3748 0%, #1a202c 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 2px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .form-content {
            padding: 50px;
        }
        
        .form-section {
            margin-bottom: 40px;
            padding-bottom: 40px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .form-section:last-child {
            border-bottom: none;
        }
        
        .section-title {
            font-size: 20px;
            color: #2d3748;
            margin-bottom: 25px;
            font-weight: 600;
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: #667eea;
            margin-right: 12px;
            border-radius: 2px;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 500;
            font-size: 14px;
        }
        
        .required {
            color: #e53e3e;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        select,
        textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .help-text {
            font-size: 12px;
            color: #718096;
            margin-top: 6px;
            font-style: italic;
        }
        
        /* Gyroscope Name Input */
        .gyro-container {
            position: relative;
            min-height: 300px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: #f7fafc;
            overflow: hidden;
            user-select: none;
        }
        
        .name-display {
            padding: 12px 16px;
            background: white;
            border-bottom: 2px solid #e2e8f0;
            font-size: 15px;
            min-height: 46px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .gyro-play-area {
            height: 250px;
            position: relative;
            cursor: crosshair;
        }
        
        .letter-floating {
            position: absolute;
            font-size: 40px;
            font-weight: bold;
            color: #667eea;
            opacity: 0;
            transition: opacity 0.3s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            pointer-events: none; /* Let clicks pass through */
        }
        
        .letter-floating.show {
            opacity: 1;
        }
        
        .drop-zone {
            position: absolute;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            border: 3px dashed #cbd5e0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #718096;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .drop-zone.use {
            background: rgba(72, 187, 120, 0.1);
            border-color: #48bb78;
        }
        
        .drop-zone.discard {
            background: rgba(245, 101, 101, 0.1);
            border-color: #f56565;
        }
        
        /* Slider for each letter */
        .letter-sliders {
            padding: 20px;
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
        }
        
        .slider-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .slider-output {
            width: 30px;
            font-weight: bold;
            color: #2d3748;
            text-align: center;
            font-size: 18px;
        }
        
        input[type="range"] {
            flex: 1;
            height: 8px;
            border-radius: 4px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .add-letter-btn {
            padding: 8px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .add-letter-btn:hover {
            background: #5568d3;
            transform: translateY(-1px);
        }
        
        /* Quantity with logarithmic slider */
        .quantity-slider-container {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .quantity-display {
            font-size: 32px;
            font-weight: bold;
            color: #2d3748;
            text-align: center;
            margin-bottom: 15px;
        }
        
        /* Checkbox that fails */
        .terms-container {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }
        
        .terms-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.6;
            color: #4a5568;
        }
        
        .status-message {
            margin-top: 10px;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            display: none;
        }
        
        .status-message.show {
            display: block;
        }
        
        .status-message.error {
            background: #fed7d7;
            color: #c53030;
        }
        
        .status-message.success {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        /* Date picker - only days */
        .date-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .day-cell {
            aspect-ratio: 1;
            border: 2px solid #cbd5e0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: 600;
            color: #4a5568;
            transition: all 0.2s;
        }
        
        .day-cell:hover {
            background: #e2e8f0;
            transform: scale(1.05);
        }
        
        .day-cell.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        /* Analog clock */
        .clock-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .clock-face {
            width: 250px;
            height: 250px;
            border: 4px solid #2d3748;
            border-radius: 50%;
            position: relative;
            background: white;
            margin-bottom: 15px;
            cursor: pointer;
        }
        
        .clock-center {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #2d3748;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
        }
        
        .clock-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            background: #2d3748;
            border-radius: 4px 4px 0 0;
            transition: transform 0.3s cubic-bezier(0.4, 2.08, 0.55, 0.44);
        }
        
        .hour-hand {
            width: 6px;
            height: 70px;
            margin-left: -3px;
            z-index: 2;
        }
        
        .minute-hand {
            width: 4px;
            height: 100px;
            margin-left: -2px;
            z-index: 1;
            background: #667eea;
        }
        
        .clock-numbers {
            position: absolute;
            width: 100%;
            height: 100%;
        }
        
        .clock-number {
            position: absolute;
            font-weight: bold;
            color: #2d3748;
        }
        
        .time-display {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }
        
        /* Phone with binary search */
        .phone-binary-container {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            text-align: center;
        }
        
        .phone-display {
            font-size: 32px;
            font-weight: bold;
            letter-spacing: 3px;
            color: #2d3748;
            margin-bottom: 20px;
            font-family: 'Courier New', monospace;
        }
        
        .binary-question {
            font-size: 18px;
            margin-bottom: 20px;
            color: #4a5568;
            min-height: 27px;
        }
        
        .binary-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .binary-btn {
            padding: 15px 40px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .binary-btn.higher {
            background: #48bb78;
            color: white;
        }
        
        .binary-btn.lower {
            background: #f56565;
            color: white;
        }
        
        .binary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .binary-info {
            margin-top: 15px;
            color: #718096;
            font-size: 14px;
        }
        
        /* Rotating CAPTCHA */
        .captcha-container {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            text-align: center;
        }
        
        .captcha-code {
            display: inline-block;
            font-size: 48px;
            letter-spacing: 12px;
            font-weight: bold;
            color: #2d3748;
            background: white;
            padding: 20px 40px;
            border: 3px solid #cbd5e0;
            border-radius: 8px;
            margin: 20px 0;
            user-select: none;
            transition: transform 0.1s;
            font-family: 'Courier New', monospace;
        }
        
        /* EULA type area */
        .eula-container {
            background: #f7fafc;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
        }
        
        .eula-reference {
            background: white;
            padding: 15px;
            border: 2px solid #cbd5e0;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 13px;
            line-height: 1.6;
            color: #4a5568;
            max-height: 120px;
            overflow-y: auto;
            user-select: none;
        }
        
        .eula-progress {
            margin: 10px 0;
            font-size: 13px;
            color: #718096;
        }
        
        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: #48bb78;
            transition: width 0.3s;
            width: 0%;
        }
        
        /* Submit button */
        .submit-section {
            text-align: center;
            padding-top: 30px;
        }
        
        .submit-btn {
            padding: 16px 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #a0aec0;
            box-shadow: none;
        }
        
        .feature-badge {
            display: inline-block;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @media (max-width: 768px) {
            .form-content {
                padding: 30px 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>NORDIC BUSINESS SOLUTIONS AB</h1>
            <p>Premium Enterprise Order Management System v3.7</p>
        </div>
        
        <div class="form-content">
            <form id="orderForm" onsubmit="event.preventDefault(); alert('Grattis! Du lyckades beställa!');">
                <div class="form-section">
                    <h2 class="section-title">
                        Kontaktinformation
                        <span class="feature-badge">Motion Enabled</span>
                    </h2>
                    
                    <div class="form-group">
                        <label>Förnamn <span class="required">*</span></label>
                        <div class="gyro-container" id="gyroContainer">
                            <div class="name-display" id="nameDisplay">Klicka här för att aktivera sensorer...</div>
                            <div class="gyro-play-area" id="gyroPlayArea">
                                <div class="drop-zone use" id="useZone">Använd</div>
                                <div class="drop-zone discard" id="discardZone">Kasta</div>
                                <div class="letter-floating" id="floatingLetter">A</div>
                            </div>
                        </div>
                        <p class="help-text">Vår patenterade Motion Input Technology™ för snabbare datainmatning. (Fungerar även med mus på desktop)</p>
                    </div>
                    
                    <div class="form-group">
                        <label>Efternamn <span class="required">*</span></label>
                        <div class="letter-sliders" id="surnameSliders">
                            <div class="slider-row">
                                <span class="slider-output">A</span>
                                <input type="range" min="1" max="26" value="1" class="surname-slider" oninput="updateSurnameLetter(this)">
                            </div>
                            <button type="button" class="add-letter-btn" onclick="addSurnameSlider()">+ Lägg till bokstav</button>
                        </div>
                        <p class="help-text">Precision Character Selection™ - Välj varje bokstav individuellt för maximal noggrannhet</p>
                    </div>
                    
                    <div class="form-group">
                        <label>E-postadress <span class="required">*</span></label>
                        <input type="email" id="email" required placeholder="namn@foretag.se">
                    </div>
                    
                    <div class="form-group">
                        <label>Telefonnummer <span class="required">*</span></label>
                        <div class="phone-binary-container">
                            <div class="phone-display" id="phoneDisplay">___-___-____</div>
                            <div class="binary-question" id="binaryQuestion">Är första siffran större än eller lika med 5?</div>
                            <div class="binary-buttons">
                                <button type="button" class="binary-btn higher" onclick="phoneBinaryGuess(true)">≥ Värde</button>
                                <button type="button" class="binary-btn lower" onclick="phoneBinaryGuess(false)">&lt; Värde</button>
                            </div>
                            <div class="binary-info" id="binaryInfo">Siffra 1 av 10</div>
                        </div>
                        <p class="help-text">Intelligent Binary Search Algorithm™ för optimerad sifferinmatning</p>
                    </div>
                </div>
                
                <div class="form-section">
                    <h2 class="section-title">
                        Beställningsdetaljer
                        <span class="feature-badge">AI Optimized</span>
                    </h2>
                    
                    <div class="form-group">
                        <label>Produktkategori <span class="required">*</span></label>
                        <select id="category" required>
                            <option value="">Välj kategori...</option>
                            <option value="software">Mjukvarulösningar</option>
                            <option value="hardware">Hårdvara</option>
                            <option value="consulting">Konsulttjänster</option>
                            <option value="support">Support & Underhåll</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Antal enheter <span class="required">*</span></label>
                        <div class="quantity-slider-container">
                            <div class="quantity-display" id="quantityDisplay">1</div>
                            <input type="range" id="quantitySlider" min="0" max="100" value="0">
                        </div>
                        <p class="help-text">Advanced Logarithmic Distribution™ - Drar du lite för långt blir det 10 000 enheter.</p>
                    </div>
                    
                    <div class="form-group">
                        <label>Önskat leveransdatum <span class="required">*</span></label>
                        <div class="date-grid" id="dateGrid"></div>
                        <input type="hidden" id="selectedDay">
                        <p class="help-text">Streamlined Date Selection™ - Du väljer dag. Systemet optimerar Månad och År baserat på logistisk kapacitet (Randomized).</p>
                    </div>
                    
                    <div class="form-group">
                        <label>Önskad leveranstid <span class="required">*</span></label>
                        <div class="clock-container">
                            <div class="clock-face" id="clockFace" onclick="handleClockClick(event)">
                                <div class="clock-numbers">
                                    <span class="clock-number" style="top: 10px; left: 50%; transform: translateX(-50%)">12</span>
                                    <span class="clock-number" style="top: 50%; right: 10px; transform: translateY(-50%)">3</span>
                                    <span class="clock-number" style="bottom: 10px; left: 50%; transform: translateX(-50%)">6</span>
                                    <span class="clock-number" style="top: 50%; left: 10px; transform: translateY(-50%)">9</span>
                                </div>
                                <div class="clock-hand hour-hand" id="hourHand"></div>
                                <div class="clock-hand minute-hand" id="minuteHand"></div>
                                <div class="clock-center"></div>
                            </div>
                            <div class="time-display" id="timeDisplay">12:00</div>
                        </div>
                        <p class="help-text">Intuitive Analog Interface™ - Klicka för timme, klicka igen för minut.</p>
                    </div>
                    
                    <div class="form-group">
                        <label>Särskilda önskemål</label>
                        <textarea id="comments" rows="4"></textarea>
                    </div>
                </div>
                
                <div class="form-section">
                    <h2 class="section-title">
                        Säkerhetsverifiering
                        <span class="feature-badge">Enterprise Security</span>
                    </h2>
                    
                    <div class="form-group">
                        <label>Säkerhetskod <span class="required">*</span></label>
                        <div class="captcha-container">
                            <p>Ange följande verifieringskod:</p>
                            <div class="captcha-code" id="captchaCode">HX7Q9</div>
                            <input type="text" id="captchaInput" placeholder="Ange kod" maxlength="5" style="max-width: 300px; margin: 0 auto;">
                        </div>
                        <p class="help-text">Adaptive CAPTCHA Technology™ som roterar för att förhindra bot-OCR.</p>
                    </div>
                </div>
                
                <div class="form-section">
                    <h2 class="section-title">
                        Villkor & Acceptans
                        <span class="feature-badge">Compliance Ready</span>
                    </h2>
                    
                    <div class="form-group">
                        <label>Orderbekräftelse <span class="required">*</span></label>
                        <div class="eula-container">
                            <div class="eula-reference" id="eulaReference">Genom att fortsätta godkänner jag härmed att Nordic Business Solutions AB behandlar mina personuppgifter enligt GDPR, accepterar bolagets leveransvillkor inklusive 14 dagars betalningsvillkor, samt bekräftar att all information i denna beställning är korrekt och fullständig.</div>
                            <textarea id="eulaInput" placeholder="Skriv av texten ovan EXAKT för att bekräfta..." style="width: 100%; min-height: 100px; margin-bottom: 10px;"></textarea>
                            <div class="eula-progress">
                                <span id="eulaProgressText">Bekräftelse: 0%</span>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="eulaProgressBar"></div>
                                </div>
                            </div>
                        </div>
                        <p class="help-text">Verified Acceptance Protocol™ - Kopiera/klistra in är avstängt för din säkerhet.</p>
                    </div>
                    
                    <div class="form-group">
                        <div class="terms-container">
                            <div class="checkbox-wrapper">
                                <input type="checkbox" id="termsCheckbox">
                                <label for="termsCheckbox" class="terms-text">
                                    Jag accepterar villkoren för behandling av personuppgifter och bekräftar att jag har läst och förstått Nordic Business Solutions ABs integritetspolicy.
                                </label>
                            </div>
                            <div class="status-message" id="checkboxStatus"></div>
                        </div>
                        <p class="help-text">Smart Consent Verification™ med intelligent (och nervös) serverkoppling.</p>
                    </div>
                </div>
                
                <div class="submit-section">
                    <button type="submit" class="submit-btn" id="submitBtn" disabled>
                        Skicka beställning
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        // --- 1. GYROSCOPE NAME INPUT (PHYSICS ENGINE) ---
        let gyroName = "";
        let gyroActive = false;
        let gyroTransitionLock = false;
        let currentLetter = "A";
        
        // Position vars
        let letterPosX = 100;
        let letterPosY = 100;
        let speedX = 0;
        let speedY = 0;
        
        const gyroContainer = document.getElementById('gyroContainer');
        const nameDisplay = document.getElementById('nameDisplay');
        const floatingLetter = document.getElementById('floatingLetter');
        const useZone = document.getElementById('useZone');
        const discardZone = document.getElementById('discardZone');
        const gyroPlayArea = document.getElementById('gyroPlayArea');
        
        // Start on click
        gyroContainer.addEventListener('click', function() {
            if(!gyroActive) {
                // Request permission for iOS 13+ devices
                if(typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                    DeviceOrientationEvent.requestPermission()
                        .then(permissionState => {
                            if(permissionState === 'granted') startGyro();
                        })
                        .catch(console.error);
                } else {
                    startGyro();
                }
            }
        });
        
        function startGyro() {
            if(gyroActive) return;
            gyroActive = true;
            nameDisplay.textContent = gyroName || "Rör musen/enheten för att styra bokstaven";
            nameDisplay.style.color = "#2d3748";
            
            // Listen to device orientation
            window.addEventListener('deviceorientation', handleOrientation);
            
            // Start the physics loop
            createNewLetter();
            requestAnimationFrame(gyroLoop);
        }
        
        function handleOrientation(e) {
            // Gamma is left/right, Beta is front/back
            // Divide by factor to control sensitivity
            speedX = (e.gamma || 0) / 5; 
            speedY = (e.beta || 0) / 5;
        }

        // Mouse fallback for desktop users
        gyroPlayArea.addEventListener('mousemove', (e) => {
            if(!gyroActive) return;
            const rect = gyroPlayArea.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Calculate speed based on distance from center
            speedX = (e.clientX - centerX) / 30;
            speedY = (e.clientY - centerY) / 30;
        });
        
        function createNewLetter() {
            // Generate A-Z or special action
            currentLetter = String.fromCharCode(65 + Math.floor(Math.random() * 26));
            const random = Math.random();
            if(random < 0.15) currentLetter = "✓"; // Done (space/submit logic could go here, but let's keep it simple)
            else if(random < 0.25) currentLetter = "⌫"; // Backspace
            
            floatingLetter.textContent = currentLetter;
            floatingLetter.classList.add('show');
            
            // Reset position to center
            const rect = gyroPlayArea.getBoundingClientRect();
            letterPosX = (rect.width / 2) - 20;
            letterPosY = (rect.height / 2) - 20;
            
            // Randomize zones
            positionZones();
            gyroTransitionLock = false;
        }
        
        function positionZones() {
            const rect = gyroPlayArea.getBoundingClientRect();
            // Simple random positioning avoiding edges slightly
            const useX = Math.random() * (rect.width - 80);
            const useY = Math.random() * (rect.height - 80);
            const discardX = Math.random() * (rect.width - 80);
            const discardY = Math.random() * (rect.height - 80);
            
            useZone.style.left = useX + 'px';
            useZone.style.top = useY + 'px';
            discardZone.style.left = discardX + 'px';
            discardZone.style.top = discardY + 'px';
        }
        
        function gyroLoop() {
            if(!gyroActive) return;
            
            updateLetterPosition();
            checkCollisions();
            
            requestAnimationFrame(gyroLoop);
        }
        
        function updateLetterPosition() {
            letterPosX += speedX;
            letterPosY += speedY;
            
            const rect = gyroPlayArea.getBoundingClientRect();
            
            // Wall bouncing logic
            if(letterPosX < 0) { letterPosX = 0; speedX *= -0.8; }
            if(letterPosX > rect.width - 40) { letterPosX = rect.width - 40; speedX *= -0.8; }
            if(letterPosY < 0) { letterPosY = 0; speedY *= -0.8; }
            if(letterPosY > rect.height - 40) { letterPosY = rect.height - 40; speedY *= -0.8; }
            
            floatingLetter.style.left = letterPosX + 'px';
            floatingLetter.style.top = letterPosY + 'px';
        }
        
        function checkCollisions() {
            if(gyroTransitionLock) return;
            
            // Calculate centers
            const lCx = letterPosX + 20;
            const lCy = letterPosY + 20;
            
            // Check Use Zone
            const uRect = useZone.getBoundingClientRect();
            const gpRect = gyroPlayArea.getBoundingClientRect();
            // Convert zone rect to relative coordinates
            const uCx = (uRect.left - gpRect.left) + 35;
            const uCy = (uRect.top - gpRect.top) + 35;
            
            // Distance formula
            const distUse = Math.sqrt(Math.pow(lCx - uCx, 2) + Math.pow(lCy - uCy, 2));
            
            if(distUse < 40) {
                handleAction('use');
                return;
            }
            
            // Check Discard Zone
            const dRect = discardZone.getBoundingClientRect();
            const dCx = (dRect.left - gpRect.left) + 35;
            const dCy = (dRect.top - gpRect.top) + 35;
            
            const distDiscard = Math.sqrt(Math.pow(lCx - dCx, 2) + Math.pow(lCy - dCy, 2));
            
            if(distDiscard < 40) {
                handleAction('discard');
                return;
            }
        }
        
        function handleAction(type) {
            gyroTransitionLock = true;
            floatingLetter.classList.remove('show');
            
            if(type === 'use') {
                useZone.style.transform = "scale(1.2)";
                setTimeout(() => useZone.style.transform = "scale(1)", 200);
                
                if(currentLetter === "⌫") {
                    gyroName = gyroName.slice(0, -1);
                } else if (currentLetter !== "✓") {
                    gyroName += currentLetter;
                }
                nameDisplay.textContent = gyroName;
            } else {
                discardZone.style.transform = "scale(1.2)";
                setTimeout(() => discardZone.style.transform = "scale(1)", 200);
            }
            
            setTimeout(createNewLetter, 500);
        }
        
        // --- 2. SURNAME SLIDERS ---
        function addSurnameSlider() {
            const container = document.getElementById('surnameSliders');
            const btn = container.querySelector('.add-letter-btn');
            
            const div = document.createElement('div');
            div.className = 'slider-row';
            div.innerHTML = `
                <span class="slider-output">A</span>
                <input type="range" min="1" max="26" value="1" class="surname-slider" oninput="updateSurnameLetter(this)">
            `;
            
            container.insertBefore(div, btn);
        }

        function updateSurnameLetter(slider) {
            const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZÅÄÖ"; // Standard + Swedish
            // Map 1-29 roughly
            const index = Math.min(slider.value - 1, letters.length - 1);
            const span = slider.previousElementSibling;
            span.textContent = letters[slider.value - 1] || "?";
        }
        
        // --- 3. BINARY PHONE NUMBER ---
        let phoneDigits = [];
        let currentPhoneDigit = 0;
        let phoneMin = 0;
        let phoneMax = 9;
        
        function updatePhoneDisplay() {
            let display = phoneDigits.join('');
            while(display.length < 10) display += '_';
            // Format: XXX-XXX-XXXX
            let formatted = "";
            if(display.length > 0) formatted += display.substring(0,3);
            if(display.length > 3) formatted += "-" + display.substring(3,6);
            if(display.length > 6) formatted += "-" + display.substring(6,10);
            
            document.getElementById('phoneDisplay').textContent = formatted || "___-___-____";
            document.getElementById('binaryInfo').textContent = `Siffra ${currentPhoneDigit + 1} av 10`;
            
            if(currentPhoneDigit < 10) {
                let mid = Math.floor((phoneMin + phoneMax) / 2);
                document.getElementById('binaryQuestion').textContent = 
                    `Är siffra ${currentPhoneDigit + 1} större än eller lika med ${mid}?`;
            } else {
                document.getElementById('binaryQuestion').textContent = "Telefonnummer registrerat.";
                document.querySelector('.binary-buttons').style.display = 'none';
                checkSubmitStatus();
            }
        }
        
        function phoneBinaryGuess(isHigher) {
            if(currentPhoneDigit >= 10) return;
            
            let mid = Math.floor((phoneMin + phoneMax) / 2);
            
            // Standard Binary Search Logic applied to 0-9
            if(isHigher) {
                // User says it is >= mid
                phoneMin = mid;
                // Trap fix: if min==mid and we need to go higher, we must increment manually to avoid infinite loop
                if(phoneMin === phoneMax - 1 && mid === phoneMin) {
                     // Wait, strictly speaking >= mid means [mid, max].
                     // But if min=8, max=9, mid=8. User says >= 8. Range is [8,9].
                     // To force a decision, we rely on the next guess.
                     // But if we are stuck, we just pick one.
                     if(Math.random() > 0.5) phoneMin++;
                }
            } else {
                // User says it is < mid
                phoneMax = mid - 1; 
                if(phoneMax < phoneMin) phoneMax = phoneMin;
            }
            
            // If range collapsed to one number, we found it
            if(phoneMin === phoneMax) {
                phoneDigits.push(phoneMin);
                currentPhoneDigit++;
                phoneMin = 0;
                phoneMax = 9;
                updatePhoneDisplay();
            } else {
                // Just update the question
                updatePhoneDisplay();
            }
        }
        
        // --- 4. LOGARITHMIC QUANTITY ---
        const quantitySlider = document.getElementById('quantitySlider');
        const quantityDisplay = document.getElementById('quantityDisplay');
        
        quantitySlider.addEventListener('input', (e) => {
            const val = parseInt(e.target.value);
            let calculated;
            
            if (val === 0) calculated = 1;
            else if (val < 20) calculated = val;
            else if (val < 50) calculated = Math.round(val * 2.5);
            else if (val < 80) calculated = Math.round(Math.pow(val, 1.8)); // Starts growing fast
            else calculated = Math.round(Math.pow(10, val / 25)); // Explosive growth
            
            quantityDisplay.textContent = calculated.toLocaleString();
        });
        
        // --- 5. DATE PICKER (RANDOM MONTH/YEAR) ---
        const dateGrid = document.getElementById('dateGrid');
        
        function initDateGrid() {
            for(let i=1; i<=31; i++) {
                const day = document.createElement('div');
                day.className = 'day-cell';
                day.textContent = i;
                day.onclick = () => selectDay(day, i);
                dateGrid.appendChild(day);
            }
        }
        
        function selectDay(element, day) {
            document.querySelectorAll('.day-cell').forEach(c => c.classList.remove('selected'));
            element.classList.add('selected');
            document.getElementById('selectedDay').value = day;
            
            // Random Month and Year assignment (The bad UI feature)
            const months = ["Januari", "Februari", "Mars", "April", "Maj", "Juni", "Juli", "Augusti", "September", "Oktober", "November", "December"];
            const randomMonth = months[Math.floor(Math.random() * months.length)];
            const randomYear = 2025 + Math.floor(Math.random() * 8); // 2025-2032
            
            // Invalid date check (e.g. Feb 30), simple retry logic
            if(day > 28 && randomMonth === "Februari") {
                selectDay(element, day); // Try again
                return;
            }
            
            const helpText = element.parentElement.nextElementSibling.nextElementSibling;
            helpText.innerHTML = `Valt datum: <strong>${day} ${randomMonth} ${randomYear}</strong> (Automatiskt optimerat för vår logistik)`;
            helpText.style.color = "#2d3748";
        }
        
        initDateGrid();
        
        // --- 6. ANALOG CLOCK ---
        let clockMode = 'hour'; // or 'minute'
        let selectedHour = 12;
        let selectedMinute = 0;
        
        function handleClockClick(e) {
            const rect = document.getElementById('clockFace').getBoundingClientRect();
            const centerX = rect.width / 2;
            const centerY = rect.height / 2;
            // Get click coordinates relative to center
            const x = e.clientX - rect.left - centerX;
            const y = e.clientY - rect.top - centerY;
            
            // Calculate angle in degrees
            let angle = Math.atan2(y, x) * (180 / Math.PI) + 90;
            if(angle < 0) angle += 360;
            
            if(clockMode === 'hour') {
                // Snap to nearest hour (30 degrees per hour)
                selectedHour = Math.round(angle / 30);
                if(selectedHour === 0) selectedHour = 12;
                
                document.getElementById('hourHand').style.transform = `translateX(-50%) rotate(${selectedHour * 30}deg)`;
                clockMode = 'minute'; // Switch mode
            } else {
                // Snap to nearest minute (6 degrees per minute)
                selectedMinute = Math.round(angle / 6);
                if(selectedMinute === 60) selectedMinute = 0;
                
                document.getElementById('minuteHand').style.transform = `translateX(-50%) rotate(${selectedMinute * 6}deg)`;
                clockMode = 'hour'; // Switch back
            }
            
            updateTimeDisplay();
        }
        
        function updateTimeDisplay() {
            const h = selectedHour.toString().padStart(2, '0');
            const m = selectedMinute.toString().padStart(2, '0');
            document.getElementById('timeDisplay').textContent = `${h}:${m}`;
        }
        
        // --- 7. ROTATING CAPTCHA ---
        const captchaCode = document.getElementById('captchaCode');
        let rotation = 0;
        
        // Animate rotation constantly
        setInterval(() => {
            rotation += 2;
            captchaCode.style.transform = `rotate(${rotation}deg)`;
        }, 50);
        
        // --- 8. EULA TYPING TEST ---
        const eulaRef = document.getElementById('eulaReference');
        const eulaInput = document.getElementById('eulaInput');
        const eulaBar = document.getElementById('eulaProgressBar');
        const eulaText = document.getElementById('eulaProgressText');
        const targetText = eulaRef.innerText.trim();
        
        eulaInput.addEventListener('input', function() {
            const current = this.value;
            let matchCount = 0;
            
            // Check exactly how many chars match from the start
            for(let i=0; i<current.length; i++) {
                if(i < targetText.length && current[i] === targetText[i]) {
                    matchCount++;
                } else {
                    break; // Stop at first error
                }
            }
            
            const percentage = Math.floor((matchCount / targetText.length) * 100);
            eulaBar.style.width = percentage + '%';
            
            if(current === targetText) {
                eulaText.textContent = "Bekräftelse: 100% - Verifierad";
                eulaText.style.color = "green";
                eulaInput.disabled = true;
                eulaInput.style.borderColor = "#48bb78";
                checkSubmitStatus();
            } else {
                eulaText.textContent = `Bekräftelse: ${percentage}% (Måste vara exakt)`;
                eulaText.style.color = "#718096";
            }
        });
        
        // Disable paste
        eulaInput.onpaste = e => {
            e.preventDefault();
            alert("Säkerhetsprotokoll: Klistra in är förbjudet.");
        };
        
        // --- 9. FLEEING CHECKBOX ---
        const termsCheckbox = document.getElementById('termsCheckbox');
        const checkboxStatus = document.getElementById('checkboxStatus');
        
        termsCheckbox.addEventListener('change', function() {
            if(this.checked) {
                checkboxStatus.textContent = "Verifierar samtycke mot server...";
                checkboxStatus.className = "status-message show";
                checkboxStatus.style.background = "#fffaf0";
                checkboxStatus.style.color = "orange";
                
                // Simulate network latency then random failure
                setTimeout(() => {
                    // 70% chance of failure
                    if(Math.random() > 0.3) {
                        this.checked = false;
                        checkboxStatus.textContent = "Felkod 419: Sessionen för samtycke löpte ut (Packet Loss). Försök igen.";
                        checkboxStatus.className = "status-message show error";
                    } else {
                        checkboxStatus.textContent = "Samtycke registrerat.";
                        checkboxStatus.className = "status-message show success";
                        checkSubmitStatus();
                    }
                }, 1200);
            } else {
                checkboxStatus.style.display = 'none';
            }
        });
        
        // --- 10. SUBMIT VALIDATION ---
        function checkSubmitStatus() {
            const isEulaDone = eulaInput.value === targetText;
            const isTermsDone = termsCheckbox.checked;
            const isPhoneDone = phoneDigits.length === 10;
            
            document.getElementById('submitBtn').disabled = !(isEulaDone && isTermsDone && isPhoneDone);
        }
        
        // Init first slider
        updateSurnameLetter(document.querySelector('.surname-slider'));
        
    </script>
</body>
</html>
