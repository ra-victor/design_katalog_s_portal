<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koncernportal | Rekvisition v5.0 (Enterprise)</title>
    <style>
        :root {
            --c-primary: #0f2c59;
            --c-secondary: #dac0a3;
            --c-bg: #f8f9fa;
            --c-panel: #ffffff;
            --c-alert: #b31312;
            --c-success: #1a5d1a;
            --font-mono: 'Consolas', 'Monaco', monospace;
            --font-sans: 'Segoe UI', sans-serif;
        }

        * { box-sizing: border-box; user-select: none; }
        
        body {
            background-color: var(--c-bg);
            font-family: var(--font-sans);
            color: #333;
            margin: 0;
            padding-bottom: 100px;
        }

        .header {
            background: var(--c-primary);
            color: white;
            padding: 20px 40px;
            border-bottom: 5px solid var(--c-secondary);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .header h1 { margin: 0; font-size: 20px; text-transform: uppercase; letter-spacing: 2px; }
        .header .meta { font-family: var(--font-mono); font-size: 11px; opacity: 0.7; margin-top: 5px; }

        .container {
            max-width: 850px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .alert-box {
            background: #fff3cd;
            border: 1px solid #ffeeba;
            color: #856404;
            padding: 15px;
            border-radius: 4px;
            font-size: 13px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* --- MODUL DESIGN --- */
        .module {
            background: var(--c-panel);
            border: 1px solid #e0e0e0;
            border-radius: 2px;
            margin-bottom: 30px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .module-header {
            background: #f1f3f5;
            padding: 12px 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .module-title {
            font-weight: 700;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--c-primary);
        }

        .module-body { padding: 25px; }

        .label {
            display: block;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 10px;
            color: #666;
        }

        .help-text {
            font-size: 11px;
            color: #888;
            font-style: italic;
            margin-top: 8px;
            border-left: 3px solid var(--c-secondary);
            padding-left: 10px;
        }

        /* --- COMPONENT: FLYWHEEL (NAME) --- */
        .flywheel-container {
            display: flex;
            gap: 20px;
            background: #e9ecef;
            padding: 20px;
            border-radius: 4px;
            align-items: center;
        }
        .fw-canvas-wrap { position: relative; width: 150px; height: 150px; }
        .fw-canvas { background: #fff; border-radius: 50%; border: 4px solid #343a40; box-shadow: inset 0 0 20px rgba(0,0,0,0.2); }
        .fw-marker { position: absolute; top: -5px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 15px solid var(--c-alert); z-index: 10; }
        .fw-controls { flex: 1; display: flex; flex-direction: column; gap: 10px; }
        .fw-meter { height: 10px; background: #ccc; width: 100%; position: relative; overflow: hidden; border-radius: 5px; }
        .fw-meter-fill { height: 100%; background: linear-gradient(90deg, #ffc107, #dc3545); width: 0%; transition: width 0.1s linear; }
        .fw-display { background: #fff; border: 2px solid #343a40; font-family: var(--font-mono); font-size: 24px; padding: 10px; min-height: 50px; letter-spacing: 5px; margin-bottom: 10px; }
        
        .btn-hold { background: #495057; color: white; border: none; padding: 15px; font-weight: bold; cursor: grab; text-transform: uppercase; font-size: 12px; border-radius: 3px; transition: background 0.2s; }
        .btn-hold:active { background: #212529; cursor: grabbing; }
        .btn-action { background: var(--c-primary); color: white; border: none; padding: 10px; font-weight: bold; cursor: pointer; text-transform: uppercase; font-size: 12px; border-radius: 3px; }
        .btn-action:hover { background: #0b1f42; }

        /* --- COMPONENT: DRIFT PHONE (VELOCITY CONTROL) --- */
        .drift-container {
            background: #212529;
            padding: 20px;
            border-radius: 8px;
            color: #0f0;
            font-family: var(--font-mono);
            text-align: center;
        }
        .drift-screen {
            background: #000;
            border: 2px solid #444;
            height: 200px;
            position: relative;
            margin-bottom: 15px;
            cursor: crosshair;
            overflow: hidden;
        }
        .drift-grid {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(2, 1fr);
            pointer-events: none;
        }
        .drift-cell { border: 1px solid #333; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #333; }
        .drift-cursor {
            width: 10px; height: 10px; background: #0f0; border-radius: 50%;
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            box-shadow: 0 0 10px #0f0;
        }
        .drift-controls { display: flex; justify-content: space-around; margin-top: 20px; }
        .knob-group { display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .rotary-knob {
            width: 60px; height: 60px; background: #e9ecef; border-radius: 50%;
            border: 4px solid #adb5bd; position: relative; cursor: ew-resize;
            box-shadow: 0 4px 0 #666;
        }
        .rotary-knob::after { content: ''; position: absolute; top: 5px; left: 50%; height: 15px; width: 4px; background: #333; transform: translateX(-50%); }
        .velocity-bar { width: 60px; height: 4px; background: #333; margin-top: 5px; position: relative; }
        .velocity-val { position: absolute; top: 0; height: 100%; background: #0f0; left: 50%; width: 0; transition: width 0.1s, left 0.1s; }

        /* --- COMPONENT: FRICTION HEAT (APPROVAL) --- */
        .heat-container {
            background: #e9ecef;
            padding: 30px;
            text-align: center;
            border-radius: 4px;
            position: relative;
        }
        .heat-pad {
            width: 100%;
            height: 100px;
            background: repeating-linear-gradient(
                45deg,
                #dee2e6,
                #dee2e6 10px,
                #e9ecef 10px,
                #e9ecef 20px
            );
            border: 2px dashed #adb5bd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            position: relative;
            overflow: hidden;
        }
        .heat-pad:active { cursor: grabbing; border-color: var(--c-primary); }
        .heat-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 0%;
            background: linear-gradient(to top, #ffc107, #dc3545);
            opacity: 0.5;
            transition: height 0.1s linear;
            pointer-events: none;
        }
        .heat-status {
            font-family: var(--font-mono);
            font-weight: bold;
            margin-top: 15px;
            height: 20px;
            color: var(--c-primary);
        }
        .thermometer {
            width: 100%; height: 10px; background: #ccc; margin-top: 10px;
            border-radius: 5px; overflow: hidden;
        }
        .thermometer-fill { height: 100%; width: 0%; background: #dc3545; transition: width 0.05s linear; }

        /* --- OTHERS --- */
        .submit-btn {
            width: 100%; padding: 20px;
            background: #ced4da; color: #6c757d;
            border: none; font-weight: bold; text-transform: uppercase;
            letter-spacing: 2px; cursor: not-allowed;
            transition: all 0.3s;
        }
        .submit-btn.active { background: var(--c-success); color: white; cursor: pointer; }

    </style>
</head>
<body>

    <div class="header">
        <h1>Koncernportal Enterprise</h1>
        <div class="meta">S√§kerhetsprotokoll v5.0.1 | Inloggad: A. Andersson</div>
    </div>

    <div class="container">
        
        <div class="alert-box">
            <span style="font-size: 24px;">‚ÑπÔ∏è</span>
            <div>
                <strong>Systemuppdatering:</strong> F√∂r att m√∂ta ISO-9001 kraven har vi implementerat fysikbaserad datainmatning. Var god notera att precision kr√§vs. Inaktivitet leder till omedelbar sessionstimeout.
            </div>
        </div>

        <!-- MODUL 1: THE MOMENTUM WHEEL (NAMN) -->
        <div class="module">
            <div class="module-header">
                <span class="module-title">1. Identifiering (Inertia System)</span>
            </div>
            <div class="module-body">
                <span class="label">Fullst√§ndigt Namn</span>
                
                <div class="flywheel-container">
                    <div class="fw-canvas-wrap">
                        <div class="fw-marker"></div>
                        <canvas id="wheelCanvas" class="fw-canvas" width="150" height="150"></canvas>
                    </div>
                    
                    <div class="fw-controls">
                        <div class="fw-display" id="nameOutput"></div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-hold" id="accelBtn" style="flex:1;">
                                ‚ö° H√•ll f√∂r Motor
                            </button>
                            <button class="btn-hold" id="brakeBtn" style="flex:1; background: #6c757d;">
                                üõë H√•ll f√∂r Broms
                            </button>
                        </div>
                        
                        <div class="fw-meter">
                            <div class="fw-meter-fill" id="rpmMeter"></div>
                        </div>
                        <div style="text-align: center; font-size: 10px; color: #666;">RPM MONITOR</div>

                        <button class="btn-action" id="stampBtn">ST√ÑMPLA BOKSTAV</button>
                    </div>
                </div>
                <div class="help-text">
                    Hjulet simulerar 50kg industriellt st√•l. H√•ll "Motor" f√∂r att bygga upp rotationshastighet. Sl√§pp f√∂r att l√•ta det snurra fritt. Bromsa manuellt. Klicka "St√§mpla" n√§r √∂nskad bokstav passerar mark√∂ren. Systemet kr√§ver att hjulet st√•r n√§stan stilla (< 5 RPM) f√∂r en tydlig st√§mpel.
                </div>
            </div>
        </div>

        <!-- MODUL 2: VELOCITY CONTROL PHONE (TELEFON) -->
        <div class="module">
            <div class="module-header">
                <span class="module-title">2. Kontakt (Drift Control)</span>
            </div>
            <div class="module-body">
                <span class="label">Telefonnummer</span>
                
                <div class="drift-container">
                    <div class="drift-screen" id="driftScreen">
                        <div class="drift-grid" id="driftGrid">
                            <!-- Grid genereras av JS -->
                        </div>
                        <div class="drift-cursor" id="driftCursor"></div>
                    </div>
                    
                    <div style="font-size: 24px; margin-bottom: 10px; border-bottom: 1px solid #444; padding-bottom: 5px;">
                        <span id="phoneOutput"></span><span style="animation: blink 1s infinite;">_</span>
                    </div>

                    <div class="drift-controls">
                        <div class="knob-group">
                            <div class="rotary-knob" id="knobX"></div>
                            <div class="velocity-bar"><div class="velocity-val" id="velBarX"></div></div>
                            <span style="font-size: 10px; color: #888;">X-THRUSTER</span>
                        </div>
                        <div class="knob-group">
                            <button class="btn-action" id="driftSelectBtn" style="height: 60px; background: #b31312; border-radius: 50%; width: 60px; font-size: 10px;">L√ÖS</button>
                            <span style="font-size: 10px; color: #888;">TARGET</span>
                        </div>
                        <div class="knob-group">
                            <div class="rotary-knob" id="knobY"></div>
                            <div class="velocity-bar"><div class="velocity-val" id="velBarY"></div></div>
                            <span style="font-size: 10px; color: #888;">Y-THRUSTER</span>
                        </div>
                    </div>
                </div>
                <div class="help-text">
                    Mark√∂ren befinner sig i friktionsl√∂s milj√∂. Rattarna styr <strong>accelerationen</strong>, inte positionen. Vrid h√∂ger f√∂r att √∂ka farten √•t h√∂ger/ner. Vrid v√§nster f√∂r att bromsa/backa. Du m√•ste motstyra f√∂r att stanna √∂ver en siffra. Klicka "L√ÖS" n√§r mark√∂ren √§r stabil √∂ver en siffra.
                </div>
            </div>
        </div>

        <!-- MODUL 3: KINETIC ENCRYPTION (GODK√ÑNNANDE) -->
        <div class="module" style="border-top: 4px solid var(--c-primary);">
            <div class="module-header">
                <span class="module-title">3. Kinetisk Signering</span>
            </div>
            <div class="module-body">
                <span class="label">Generera Friktionsv√§rme f√∂r Kryptering</span>
                
                <div class="heat-container">
                    <div class="heat-pad" id="heatPad">
                        <span style="pointer-events: none; position: relative; z-index: 10; color: #495057; font-weight: bold;">
                            GNUGGA H√ÑR
                        </span>
                        <div class="heat-overlay" id="heatOverlay"></div>
                    </div>
                    
                    <div class="thermometer">
                        <div class="thermometer-fill" id="heatMeter"></div>
                    </div>
                    
                    <div class="heat-status" id="heatStatus">SYSTEM COLD</div>
                </div>

                <div class="help-text">
                    Dra musen snabbt fram och tillbaka √∂ver ytan f√∂r att generera v√§rme. Du m√•ste h√•lla temperaturen i den "gr√∂na zonen" (80-95%) i 3 sekunder f√∂r att slutf√∂ra signeringen. 
                    <br><strong>VARNING:</strong> Om du slutar gnugga svalnar systemet omedelbart. Om du n√•r 100% √∂verhettas systemet och nollst√§lls (Emergency Venting).
                </div>

                <button class="submit-btn" id="submitBtn">Skicka Rekvisition</button>
            </div>
        </div>

    </div>

    <script>
        /**
         * KONCERN IT - PHYSICS ENGINE v5.0
         * Inga bibliotek. Endast r√• lidelse.
         */
        
        // --- 1. THE FLYWHEEL (Massive Inertia Simulation) ---
        (() => {
            const canvas = document.getElementById('wheelCanvas');
            const ctx = canvas.getContext('2d');
            const rpmMeter = document.getElementById('rpmMeter');
            const output = document.getElementById('nameOutput');
            
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ö√Ñ√ñ_".split("");
            const segmentAngle = (Math.PI * 2) / chars.length;
            
            // Fysikvariabler
            let angle = 0;
            let velocity = 0;
            let acceleration = 0;
            const FRICTION = 0.995; // L√•g friktion (tungt hjul)
            const MOTOR_POWER = 0.005;
            const BRAKE_POWER = 0.02;
            
            let isAccelerating = false;
            let isBraking = false;

            // Controls
            document.getElementById('accelBtn').addEventListener('mousedown', () => isAccelerating = true);
            document.getElementById('accelBtn').addEventListener('mouseup', () => isAccelerating = false);
            document.getElementById('accelBtn').addEventListener('mouseleave', () => isAccelerating = false);
            
            document.getElementById('brakeBtn').addEventListener('mousedown', () => isBraking = true);
            document.getElementById('brakeBtn').addEventListener('mouseup', () => isBraking = false);
            document.getElementById('brakeBtn').addEventListener('mouseleave', () => isBraking = false);

            function loop() {
                // Fysikuppdatering
                if (isAccelerating) velocity += MOTOR_POWER;
                if (isBraking) velocity *= (1 - BRAKE_POWER);
                
                velocity *= FRICTION;
                angle += velocity;
                
                // Rendera
                ctx.clearRect(0, 0, 150, 150);
                ctx.save();
                ctx.translate(75, 75);
                ctx.rotate(angle);
                
                // Hjuldesign
                ctx.beginPath();
                ctx.arc(0, 0, 70, 0, Math.PI * 2);
                ctx.fillStyle = "#f8f9fa";
                ctx.fill();
                ctx.strokeStyle = "#343a40";
                ctx.lineWidth = 2;
                ctx.stroke();

                // Text
                ctx.fillStyle = "#212529";
                ctx.font = "bold 12px monospace";
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                
                for (let i = 0; i < chars.length; i++) {
                    ctx.save();
                    const theta = i * segmentAngle;
                    ctx.rotate(theta);
                    ctx.translate(0, -55); // Radie f√∂r text
                    ctx.rotate(-angle - theta); // Motrotera text s√• den alltid √§r l√§sbar? Nej, l√•t den snurra.
                    ctx.rotate(angle + theta + Math.PI/2); // Orientera mot mitten
                    ctx.fillText(chars[i], 0, 0);
                    
                    // Streck
                    ctx.beginPath();
                    ctx.moveTo(0, 15);
                    ctx.lineTo(0, 20);
                    ctx.stroke();
                    ctx.restore();
                }
                
                ctx.restore();
                
                // Uppdatera RPM m√§tare (visuellt max ca 0.5 rad/frame)
                const rpmPct = Math.min(100, (Math.abs(velocity) / 0.3) * 100);
                rpmMeter.style.width = rpmPct + "%";
                rpmMeter.style.background = rpmPct > 10 ? (rpmPct > 80 ? "#dc3545" : "#ffc107") : "#28a745"; // Gr√∂nt om s√§kert att st√§mpla

                requestAnimationFrame(loop);
            }
            loop();

            // St√§mpla
            document.getElementById('stampBtn').addEventListener('click', () => {
                // M√•ste st√• n√§stan stilla
                if (Math.abs(velocity) > 0.02) {
                    alert("S√ÑKERHETSVARNING: F√∂rs√∂k att interagera med roterande maskineri. V√§nta tills hjulet stannat.");
                    return;
                }

                // Ber√§kna vilken bokstav som √§r klockan 12
                // Vinkel normaliseras 0 till 2PI
                let normAngle = (angle % (Math.PI * 2));
                if (normAngle < 0) normAngle += Math.PI * 2;
                
                // Eftersom vi ritar medurs, och 0 √§r klockan 3 (i canvas default), men vi roterade texten...
                // Vi g√∂r det enkelt: Invertera rotationen f√∂r att hitta index.
                // Hjulet roterar medurs (positiv vinkel). Index 0 √§r vid 12-slaget vid start?
                // Vid start (angle 0), 'A' (index 0) √§r ritad vid -90 grader (kl 12) via translate(0, -55).
                
                // Indexet som √§r h√∂gst upp:
                // Vi m√•ste kompensera f√∂r rotationen.
                const totalSegments = chars.length;
                // Hur m√•nga segment har vi roterat "bak√•t" fr√•n 12-slaget?
                const rotationSteps = Math.round(normAngle / segmentAngle);
                
                // Index r√∂r sig moturs n√§r hjulet snurrar medurs.
                let index = (chars.length - rotationSteps) % chars.length;
                
                const char = chars[index];
                if (char === "_") output.textContent += " ";
                else output.textContent += char;
                
                // Liten "kick" n√§r man st√§mplar
                velocity += (Math.random() - 0.5) * 0.05;
            });
        })();


        // --- 2. DRIFT PHONE (Velocity Control) ---
        (() => {
            const cursor = document.getElementById('driftCursor');
            const grid = document.getElementById('driftGrid');
            const output = document.getElementById('phoneOutput');
            
            // Grid setup (0-9)
            const digits = [1, 2, 3, 4, 5, 6, 7, 8, 9, 0];
            digits.forEach(d => {
                const el = document.createElement('div');
                el.className = 'drift-cell';
                el.textContent = d;
                grid.appendChild(el);
            });

            // Fysik
            let posX = 50; // %
            let posY = 50; // %
            let velX = 0;
            let velY = 0;
            
            // Ratt-v√§rden (Acceleration request)
            let thrustX = 0;
            let thrustY = 0;

            function updatePhysics() {
                // Applicera thrust till velocity
                velX += thrustX * 0.005;
                velY += thrustY * 0.005;
                
                // Uppdatera position
                posX += velX;
                posY += velY;
                
                // Studsa mot v√§ggar (elastisk kollision)
                if (posX < 0) { posX = 0; velX *= -0.8; }
                if (posX > 100) { posX = 100; velX *= -0.8; }
                if (posY < 0) { posY = 0; velY *= -0.8; }
                if (posY > 100) { posY = 100; velY *= -0.8; }
                
                // Rendera mark√∂r
                cursor.style.left = posX + "%";
                cursor.style.top = posY + "%";
                
                // Visualisera velocity p√• m√§tare
                const barX = document.getElementById('velBarX');
                const barY = document.getElementById('velBarY');
                
                // Mappa thrust (-10 till 10) till visuell bar
                const setBar = (el, val) => {
                    // val √§r thrust (-10 to 10 approx)
                    let pct = (val / 20) * 100; // width from center
                    if (val > 0) {
                        el.style.left = "50%";
                        el.style.width = Math.min(50, val * 5) + "%";
                    } else {
                        let w = Math.min(50, Math.abs(val) * 5);
                        el.style.left = (50 - w) + "%";
                        el.style.width = w + "%";
                    }
                };
                
                setBar(barX, thrustX);
                setBar(barY, thrustY);

                requestAnimationFrame(updatePhysics);
            }
            updatePhysics();

            // Knob Logic (Infinite Scroll styr Thrust)
            function setupKnob(id, axis) {
                const knob = document.getElementById(id);
                let startY = 0;
                let currentRot = 0;

                knob.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    startY = e.clientY;
                    
                    const move = (ev) => {
                        const delta = startY - ev.clientY;
                        currentRot += delta;
                        knob.style.transform = `rotate(${currentRot}deg)`;
                        startY = ev.clientY;
                        
                        // √Ñndra thrust
                        if (axis === 'x') thrustX = Math.max(-10, Math.min(10, thrustX + delta * 0.05));
                        if (axis === 'y') thrustY = Math.max(-10, Math.min(10, thrustY + delta * 0.05));
                    };
                    
                    const up = () => {
                        document.removeEventListener('mousemove', move);
                        document.removeEventListener('mouseup', up);
                    };
                    document.addEventListener('mousemove', move);
                    document.addEventListener('mouseup', up);
                });
            }
            setupKnob('knobX', 'x');
            setupKnob('knobY', 'y');

            // Select Logic
            document.getElementById('driftSelectBtn').addEventListener('click', () => {
                // M√•ste vara stabil f√∂r att l√•sa
                const speed = Math.hypot(velX, velY);
                if (speed > 0.1) {
                    alert("SIGNAL OTYDLIG: M√•let r√∂r sig f√∂r snabbt f√∂r triangulering. Stabilisera dr√∂naren.");
                    return;
                }

                // Hitta cell
                // Grid 5x2.
                // Col bredd = 20%, Row h√∂jd = 50%
                const col = Math.floor(posX / 20);
                const row = Math.floor(posY / 50);
                
                // index map:
                // 0 1 2 3 4
                // 5 6 7 8 9
                // Men arrayen √§r [1,2,3,4,5,6,7,8,9,0]
                // Row 0: index 0-4 -> 1-5
                // Row 1: index 5-9 -> 6-0
                
                const gridIdx = row * 5 + col;
                if (gridIdx >= 0 && gridIdx < 10) {
                    output.textContent += digits[gridIdx];
                }
            });
        })();


        // --- 3. KINETIC SIGNING (Heat/Friction) ---
        (() => {
            const pad = document.getElementById('heatPad');
            const overlay = document.getElementById('heatOverlay');
            const meter = document.getElementById('heatMeter');
            const status = document.getElementById('heatStatus');
            const submit = document.getElementById('submitBtn');
            
            let heat = 0; // 0-100
            let successTimer = 0;
            let lastX = 0;
            let lastY = 0;
            let isRubbing = false;
            
            // Konstanter
            const HEAT_GAIN_FACTOR = 0.15; // Hur mycket v√§rme per pixel r√∂relse
            const COOLING_RATE = 0.8; // Hur mycket v√§rme tappas per frame
            const TARGET_MIN = 80;
            const TARGET_MAX = 98;

            pad.addEventListener('mousedown', (e) => {
                isRubbing = true;
                lastX = e.clientX;
                lastY = e.clientY;
            });
            
            window.addEventListener('mouseup', () => isRubbing = false);

            window.addEventListener('mousemove', (e) => {
                if (!isRubbing) return;
                
                const delta = Math.hypot(e.clientX - lastX, e.clientY - lastY);
                heat += delta * HEAT_GAIN_FACTOR;
                
                lastX = e.clientX;
                lastY = e.clientY;
            });

            function loop() {
                // Kylning (alltid aktiv)
                heat -= COOLING_RATE;
                if (heat < 0) heat = 0;
                
                // √ñverhettning
                if (heat >= 100) {
                    heat = 0;
                    status.textContent = "‚ö†Ô∏è OVERHEAT! EMERGENCY VENTING!";
                    status.style.color = "red";
                    successTimer = 0;
                }

                // UI Uppdatering
                meter.style.width = heat + "%";
                overlay.style.height = heat + "%";
                
                // F√§rgkodning
                if (heat < TARGET_MIN) {
                    meter.style.background = "#dc3545"; // Kall
                } else if (heat > TARGET_MAX) {
                    meter.style.background = "#b31312"; // Varning
                } else {
                    meter.style.background = "#28a745"; // Perfekt
                }

                // Logik f√∂r succ√©
                if (heat >= TARGET_MIN && heat <= TARGET_MAX) {
                    successTimer += 1/60; // 60fps approx
                    status.textContent = `KRYPTERAR... ${(successTimer/3 * 100).toFixed(0)}%`;
                    status.style.color = "#28a745";
                    
                    if (successTimer >= 3) {
                        // KLAR
                        status.textContent = "SIGNATUR VERIFIERAD";
                        pad.style.background = "#d4edda";
                        submit.disabled = false;
                        submit.classList.add('active');
                        // L√•s modulen (fusk: sluta loopa eller s√§tt flagga)
                        return; 
                    }
                } else {
                    // Reset om man hamnar utanf√∂r zonen
                    if (successTimer > 0) {
                         status.textContent = "KRYPTERING AVBRUTEN (TEMP OSTABIL)";
                         status.style.color = "#fd7e14";
                    }
                    successTimer = 0;
                    if (heat < TARGET_MIN && heat > 0 && status.textContent !== "‚ö†Ô∏è OVERHEAT! EMERGENCY VENTING!") {
                        status.textContent = "SYSTEM COLD - √ñKA FRIKTION";
                        status.style.color = "#0f2c59";
                    }
                }

                requestAnimationFrame(loop);
            }
            loop();

            submit.addEventListener('click', () => {
                alert("REKVISITION MOTTAGEN.\n\nDin plats i k√∂n: 4,392.\nBer√§knad handl√§ggningstid: 18-24 m√•nader.");
                location.reload();
            });

        })();

    </script>
</body>
</html>
